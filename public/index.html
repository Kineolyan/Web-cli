<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.13/semantic.min.css">
<script src="https://npmcdn.com/xstream@5.0.6/dist/xstream.min.js"></script>
<script src="https://npmcdn.com/@cycle/dom@10.0.0-rc34/dist/cycle-dom.min.js"></script>
<script src="https://npmcdn.com/@cycle/xstream-run@3.0.2/dist/cycle.min.js"></script>
<script src="https://npmcdn.com/@cycle/http@9.0.0-rc9/dist/cycle-http-driver.min.js"></script>
  <meta charset="utf-8">
  <title>Web CLI for Marvin</title>
</head>
<body>
	<div id="app"></div>
	<script type="text/javascript">
const xs = xstream.default;
const {div, input, button, h1, h4, a, makeDOMDriver, li, ul} = CycleDOM;
const {makeHTTPDriver} = CycleHTTPDriver;

const DEFAULT_VALUE = 50;

function btn(sources, id, {name, classes, url}) {
  url = 'https://jsonplaceholder.typicode.com/users/1'; // FIXME tests

  const onClick$ = sources.DOM.select(`#${id}`)
    .events('click');

  const httpCategory = `action-${id}`;
  const http$ = onClick$.map(() => ({
    url,
    category: httpCategory,
    method: 'GET'
  }));

  const state$ = sources.HTTP.select(httpCategory)
    .flatten()
    .map(res => ({success: res.ok}))
    .startWith(null);

  const btnDom$ = state$.map(count =>
    button(
      `#${id}${classes.map(c => `.${c}`).join(' ')}`,
      [name]));

  return {
    state: state$,
    http: http$,
    dom: btnDom$
  };
}

function main(sources) {
  const shutDown$ = btn(
    sources,
    'shutdown-marvin',
    {
      name: 'Shutdown Marvin',
      url: '/actions/os/shutdown',
      classes: ['massive', 'ui', 'button'],
    });
  const reboot$ = btn(
    sources,
    'reboot-marvin',
    {
      name: 'Reboot Marvin',
      url: '/actions/os/reboot',
      classes: ['massive', 'ui', 'button'],
    });
  const restartPlex$ = btn(
    sources,
    'restart-plex',
    {
      name: 'Restart Plex',
      url: '/actions/plex/restart',
      classes: ['massive', 'ui', 'button'],
    });

  const state$ = xs.combine(
    shutDown$.state,
    reboot$.state,
    restartPlex$.state)
    .map(([count, c1, c2]) => ({count, c1, c2}));

  const counts$ = state$.map(state =>
    div([`${state.count} ${state.c1} ${state.c2}`]));

  const vdom$ = xs.combine(
      shutDown$.dom,
      reboot$.dom,
      restartPlex$.dom,
      counts$)
    .map(([shutDown, reboot, restartPlex, cs, h]) =>
      div([
        div([shutDown]),
        div([reboot]),
        div([restartPlex]),
        cs
      ]));

  const http$ = xs.combine(
    shutDown$.http)
    .map(req => {
      console.log(req)
      return req;
    });

  return {
    DOM: vdom$,
    HTTP: http$
  };
}

Cycle.run(main, {
  DOM: makeDOMDriver('#app'),
  HTTP: makeHTTPDriver()
});
	</script>
</body>
</html>


